{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "file-upload",
  "type": "registry:component",
  "title": "File Upload",
  "description": "A file upload component with drag and drop or upload files.",
  "dependencies": [
    "lucide-react",
    "react-dropzone",
    "sonner",
    "@radix-ui/react-slot",
    "class-variance-authority"
  ],
  "registryDependencies": [
    "https://ntt-shadcn-registry.vercel.app/r/button.json",
    "https://ntt-shadcn-registry.vercel.app/r/input.json",
    "https://ntt-shadcn-registry.vercel.app/r/spinner.json"
  ],
  "files": [
    {
      "path": "src/registry/new-york/molecules/file-upload/components/file-upload.tsx",
      "content": "import { CloudUpload, FileIcon, XIcon } from 'lucide-react'\nimport * as React from 'react'\nimport { type DropzoneOptions, type DropzoneState, type FileRejection, useDropzone } from 'react-dropzone'\nimport { toast } from 'sonner'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { cn } from '@/utils/ui'\nimport { getSizeText, type UploadedFile } from './lib'\n\n// File upload\nexport type FileUploadValue = Array<File | UploadedFile>\n\nexport type FileUploadProps = {\n  value: FileUploadValue\n  dropzoneOptions?: DropzoneOptions\n  isReplaceOnSelect?: boolean\n  isDisabled?: boolean\n  onValueChange: (value: FileUploadProps['value']) => void\n} & React.HTMLAttributes<HTMLDivElement>\n\nexport type FileUploadContextValue = Pick<FileUploadProps, 'value' | 'onValueChange'> & {\n  dropzoneState: DropzoneState\n  isDisabled: boolean\n}\n\nconst FileUploadContext = React.createContext<FileUploadContextValue | null>(null)\n\nexport const useFileUploadContext = () => {\n  const context = React.useContext(FileUploadContext)\n  if (!context) {\n    throw new Error('useFileUploadContext must be used within the FileUpload')\n  }\n  return context\n}\n\nexport const FileUpload = ({\n  className,\n  dropzoneOptions,\n  value,\n  isReplaceOnSelect: isReplaceOnSelectProp,\n  isDisabled: isDisabledProp,\n  children,\n  dir,\n  onValueChange,\n  ...props\n}: FileUploadProps) => {\n  const { maxFiles = 1, maxSize = 20 * 1024 * 1024, ...restDropzoneOptions } = dropzoneOptions ?? {}\n  const isReplaceOnSelect = maxFiles === 1 ? true : isReplaceOnSelectProp\n  const multiple = maxFiles > 1\n  const isDisabled = Boolean(\n    isDisabledProp !== undefined ? isDisabledProp : value.length === maxFiles && !isReplaceOnSelect\n  )\n\n  // Dropzone\n  const dropzoneState = useDropzone({\n    maxFiles,\n    maxSize,\n    multiple,\n    disabled: isDisabled,\n    ...restDropzoneOptions,\n    onDrop: React.useCallback(\n      (acceptedFiles: File[], rejectedFiles: FileRejection[]) => {\n        const newValues = [...value]\n\n        if (isReplaceOnSelect) {\n          newValues.splice(0, newValues.length)\n        }\n\n        acceptedFiles.forEach((acceptedFile) => {\n          if (newValues.length < maxFiles) {\n            newValues.push(acceptedFile)\n          }\n        })\n\n        onValueChange(newValues)\n\n        if (rejectedFiles.length > 0) {\n          if (\n            rejectedFiles.some((rejectedFile) => rejectedFile.errors.some((error) => error.code === 'too-many-files'))\n          ) {\n            toast.warning('The number of files exceeds the allowed number', {\n              description: `Only ${maxFiles} files are allowed to be uploaded`\n            })\n            return\n          }\n\n          rejectedFiles.forEach((rejectedFile) => {\n            if (rejectedFile.errors[0]?.code === 'file-too-large') {\n              toast.warning('File size exceeds the allowed limit', {\n                description: `File ${rejectedFile.file.name} (Maximum size is ${Math.round(maxSize / 1024 / 1024).toString()}MB)`\n              })\n              return\n            }\n\n            if (rejectedFile.errors[0]?.code === 'file-invalid-type') {\n              const acceptedExtensions = Object.values(dropzoneOptions?.accept ?? {}).reduce<string[]>((acc, cur) => {\n                acc.push(...cur.map((extension) => extension))\n                return acc\n              }, [])\n\n              toast.warning('Unsupported file format', {\n                description: `File ${rejectedFile.file.name} (Allowed formats are ${acceptedExtensions.join(', ')})`\n              })\n              return\n            }\n\n            toast.warning('Error', {\n              description: 'An error occurred while uploading the file'\n            })\n          })\n        }\n      },\n      [value, isReplaceOnSelect, maxFiles, maxSize, dropzoneOptions?.accept, onValueChange]\n    )\n  })\n\n  // Template\n  return (\n    <FileUploadContext.Provider\n      value={{\n        value,\n        dropzoneState,\n        isDisabled,\n        onValueChange\n      }}\n    >\n      <div className={cn('w-full space-y-2', className)} dir={dir} {...props}>\n        {children}\n      </div>\n    </FileUploadContext.Provider>\n  )\n}\n\n// File upload input\nexport type FileUploadInputProps = React.HTMLAttributes<HTMLDivElement>\n\nexport const FileUploadInput = ({ id, className, children, ...restProps }: FileUploadInputProps) => {\n  // Hooks\n  const { dropzoneState, isDisabled } = useFileUploadContext()\n  const dropzoneRootProps = isDisabled ? {} : dropzoneState.getRootProps()\n\n  // Template\n  return (\n    <div\n      className={cn(\n        'relative w-full rounded-md border bg-transparent text-sm hover:bg-accent/40 aria-invalid:border-destructive dark:bg-input/30',\n        isDisabled ? 'cursor-not-allowed opacity-50' : 'cursor-default',\n        className\n      )}\n      {...dropzoneRootProps}\n      {...restProps}\n    >\n      {children ?? (\n        <div className='flex w-full flex-col items-center justify-center gap-4 p-4 text-muted-foreground'>\n          <CloudUpload className='size-10' />\n          <span className='text-center'>Drag and drop a file here or select a file</span>\n        </div>\n      )}\n\n      <Input ref={dropzoneState.inputRef} id={id} disabled={isDisabled} {...dropzoneState.getInputProps()} />\n    </div>\n  )\n}\n\n// File upload content\nexport type FileUploadContentProps = React.PropsWithChildren & { className?: string }\nexport const FileUploadContent = ({ className, children }: FileUploadContentProps) => {\n  // Template\n  return (\n    <div className={cn('max-h-80 overflow-auto', className)}>\n      <div className='space-y-2'>{children}</div>\n    </div>\n  )\n}\n\n// File uploader item\nexport type FileUploaderItemProps = React.HTMLAttributes<HTMLDivElement> & {\n  value: FileUploadValue[number]\n  index: number\n}\n\nexport const FileUploadItem = ({ value, index, className, children }: FileUploaderItemProps) => {\n  // Hooks\n  const { value: fileUploadValue, onValueChange } = useFileUploadContext()\n\n  // Memos\n  const { name, size } = React.useMemo<{ name: string; size: string }>(() => {\n    const size = value instanceof File ? value.size : (value.compress_info?.['']?.size ?? 0)\n    const name = value instanceof File ? value.name : value.original\n    return {\n      name,\n      size: getSizeText(size)\n    }\n  }, [value])\n\n  // Template\n  return (\n    <div\n      className={cn(\n        'flex cursor-default items-center justify-between gap-2 overflow-hidden rounded-md border bg-transparent p-2 transition-colors hover:bg-accent/40',\n        className\n      )}\n    >\n      {children ?? (\n        <div className='flex items-center gap-2 overflow-hidden'>\n          <div className='flex size-10 shrink-0 items-center justify-center rounded-full border'>\n            <FileIcon className='size-4' />\n          </div>\n\n          <div className='space-y-2'>\n            <div>{name}</div>\n            <div>{size}</div>\n          </div>\n        </div>\n      )}\n\n      <Button\n        variant='ghost'\n        size='icon'\n        onClick={() => {\n          const newFileUploadValue = [...fileUploadValue]\n          newFileUploadValue.splice(index, 1)\n          onValueChange(newFileUploadValue)\n        }}\n      >\n        <XIcon />\n      </Button>\n    </div>\n  )\n}\n",
      "type": "registry:ui",
      "target": "src/components/molecules/file-upload/file-upload.tsx"
    },
    {
      "path": "src/registry/new-york/molecules/file-upload/components/lib.ts",
      "content": "import React from 'react'\nimport { toast } from 'sonner'\n\n// [T] Uploaded file\nexport interface UploadedFile {\n  id: string\n  path: string\n  original: string\n  mime: string\n  compress_info: Record<\n    string,\n    {\n      ext: string\n      size: number\n    }\n  >\n}\n\n// [U] Get file\nexport const getFileUrl = (path: string) => {\n  if (path.startsWith('https')) {\n    return path\n  }\n  return `${path}`\n}\n\n// [U] Get size text\nexport const getSizeText = (size: number) => {\n  return size < 1024 * 1024 ? `${(size / 1024).toFixed(2)}Kb` : `${(size / 1024 / 1024).toFixed(2)}MB`\n}\n\n// [H] Use file upload\nexport const useFileUpload = (args?: { isThrowError?: boolean }) => {\n  // Args\n  const { isThrowError = false } = args ?? {}\n\n  // Methods\n  const uploadFile = React.useCallback(\n    async (file: File): Promise<UploadedFile | null> => {\n      try {\n        console.log(file)\n        // Mutate\n\n        // Extract response and return value\n        return null\n      } catch {\n        if (isThrowError) {\n          throw new Error('An error occurred when upload the file')\n        }\n        toast.error('Failure', {\n          description: 'An error occurred when upload the file'\n        })\n        return null\n      }\n    },\n    [isThrowError]\n  )\n\n  return {\n    uploadFile,\n    isUploadFilePending: false\n  }\n}\n",
      "type": "registry:file",
      "target": "src/components/molecules/file-upload/lib.ts"
    },
    {
      "path": "src/registry/new-york/molecules/file-upload/components/index.ts",
      "content": "export * from './file-upload'\nexport * from './lib'\n",
      "type": "registry:file",
      "target": "src/components/molecules/file-upload/index.ts"
    }
  ]
}